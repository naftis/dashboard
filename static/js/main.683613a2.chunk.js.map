{"version":3,"sources":["services/weather.ts","services/forecast.ts","services/time.ts","components/BusStop.tsx","components/LiveCamera.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["API_BASE_URL","defaultOptions","appid","lang","units","query","apiEndpoint","params","a","url","payload","queryString","fetch","response","json","weather","cityName","q","result","weatherIcons","doubleDigit","num","toString","padStart","formatTime","timeOfDay","options","hours","minutes","showSeconds","seconds","replace","STOPS","background","BUS_SCHEDULES","gql","BusStop","useState","time","setTime","icon","setIcon","temperature","setTemperature","getWeather","then","x","temp","main","toFixed","useEffect","interval","setInterval","clearInterval","handleTime","localTime","Date","toLocaleTimeString","hour12","timeout","data","useQuery","variables","stopIds","Object","keys","numberOfDepartures","pollInterval","stoptimes","stops","flatMap","stop","stoptimesWithoutPatterns","sort","b","realtimeDeparture","serviceDay","getTime","className","Number","map","stoptime","i","daySeconds","style","gtfsId","trip","route","shortName","Math","floor","LiveCamera","goBack","bind","useDoubleTap","height","width","position","left","top","right","bottom","zIndex","title","src","borderWidth","App","selectedPage","setSelectedPage","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","client","ApolloClient","uri","cache","InMemoryCache","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.683613a2.chunk.js","sourcesContent":["import { IForecast, IWeather } from \"./types\";\nimport * as queryString from \"query-string\";\n\nconst API_BASE_URL = \"https://api.openweathermap.org/data/2.5/\";\n\nconst defaultOptions = {\n  appid: \"2b0ad50b08d453642b2296fd8d877fee\",\n  lang: \"fi\",\n  units: \"metric\",\n};\n\nasync function query(\n  apiEndpoint: string,\n  params: object\n): Promise<IForecast | IWeather> {\n  const url = API_BASE_URL + apiEndpoint;\n  const payload = queryString.stringify({\n    ...params,\n    ...defaultOptions,\n  });\n\n  const response = await fetch(`${url}?${payload}`);\n  const json = await response.json();\n\n  return json;\n}\n\nexport const weather = {\n  async getByCityName(cityName: string): Promise<IWeather> {\n    const result = await query(\"weather\", { q: cityName });\n    return result as IWeather;\n  },\n\n  async getByCityId(cityId: string): Promise<IWeather> {\n    const result = await query(\"weather\", { id: cityId });\n    return result as IWeather;\n  },\n\n  async getByGeoCoords(\n    lat: number | string,\n    lon: number | string\n  ): Promise<IWeather> {\n    const result = await query(\"weather\", { lat, lon });\n    return result as IWeather;\n  },\n\n  async getByZipCode(zipCode: number | string): Promise<IWeather> {\n    const result = await query(\"weather\", { zip: zipCode });\n    return result as IWeather;\n  },\n};\n\nexport const forecast = {\n  async getByCityName(cityName: string): Promise<IForecast> {\n    const result = await query(\"forecast\", { q: cityName });\n    return result as IForecast;\n  },\n\n  async getByCityId(cityId: string): Promise<IForecast> {\n    const result = await query(\"forecast\", { id: cityId });\n    return result as IForecast;\n  },\n\n  async getByGeoCoords(\n    lat: number | string,\n    lon: number | string\n  ): Promise<IForecast> {\n    const result = await query(\"forecast\", { lat, lon });\n    return result as IForecast;\n  },\n\n  async getByZipCode(zipCode: number | string): Promise<IForecast> {\n    const result = await query(\"forecast\", { zip: zipCode });\n    return result as IForecast;\n  },\n};\n\nexport async function validateCity(cityName: string) {\n  try {\n    const resp = await weather.getByCityName(cityName);\n    return resp.cod === 200;\n  } catch {\n    return false;\n  }\n}\n","import dateFormat from \"dateformat\";\nimport { forecast } from \"./weather\";\n\nexport async function getForecastText(\n  cityName: string,\n  limit: number = 8\n): Promise<string | undefined> {\n  const data = await forecast.getByCityName(cityName);\n\n  if (!data.list) {\n    return;\n  }\n\n  const items = data.list.slice(0, limit + 1);\n  const forecastLines = items\n    .map((item) => {\n      const icon = (weatherIcons as any)[item.weather[0].icon] as string;\n      const time = dateFormat(new Date(item.dt * 1000), \"HH:MM\");\n      const temp = item.main.temp.toFixed(1);\n\n      return `\\`${icon.padEnd(3, \" \")} ${time.padEnd(8, \" \")} ${temp}°C\\``;\n    })\n    .join(\"\\n\");\n\n  if (!forecastLines) {\n    return \"error\";\n  }\n\n  return `*${data.city.name}*\\n${forecastLines}`;\n}\n\nexport const weatherIcons = {\n  \"01d\": \"☀️\",\n  \"01n\": \"☀️\",\n  \"02d\": \"⛅️\",\n  \"02n\": \"⛅️\",\n  \"03d\": \"☁️\",\n  \"03n\": \"☁️\",\n  \"04d\": \"☁️\",\n  \"04n\": \"☁️\",\n  \"09d\": \"🌧\",\n  \"09n\": \"🌧\",\n  \"10d\": \"🌦\",\n  \"10n\": \"🌦\",\n  \"11d\": \"⛈\",\n  \"11n\": \"⛈\",\n  \"13d\": \"🌨\",\n  \"13n\": \"🌨\",\n  \"50d\": \"🌫\",\n  \"50n\": \"🌫\",\n};\n","export type DaySeconds = number;\nexport type Hours = number;\nexport type Minutes = number;\nexport type Seconds = number;\n\nexport interface ITimeOfDay {\n  hours: Hours;\n  minutes: Minutes;\n  seconds: Seconds;\n}\n\nexport const parseDaySeconds = (daySeconds: DaySeconds): ITimeOfDay => ({\n  hours: Math.floor(daySeconds / (60 * 60)),\n  minutes: Math.floor(daySeconds / 60) % 60,\n  seconds: daySeconds % 60,\n});\n\nconst doubleDigit = (num: string | number) => num.toString().padStart(2, \"0\");\n\nexport interface IformatTimeOptions {\n  showSeconds?: boolean;\n}\n\nexport const formatTime = (\n  timeOfDay: ITimeOfDay,\n  options: IformatTimeOptions = {}\n): string =>\n  `${doubleDigit(timeOfDay.hours)}:${doubleDigit(timeOfDay.minutes)}${\n    options.showSeconds ? `:${doubleDigit(timeOfDay.seconds)}` : \"\"\n  }`\n    .replace(/^25/, \"01\")\n    .replace(/^24/, \"00\");\n","import { gql, useQuery } from \"@apollo/client\";\nimport { useEffect, useState } from \"react\";\nimport { weatherIcons } from \"../services/forecast\";\nimport { formatTime, parseDaySeconds } from \"../services/time\";\nimport { weather } from \"../services/weather\";\nimport \"./BusStop.css\";\n\nconst STOPS = {\n  \"tampere:0819\": {\n    background: \"none\",\n  },\n  \"tampere:4511\": {\n    background: \"rgba(6,70,107,0.29)\",\n  },\n};\n\nconst BUS_SCHEDULES = gql`\n  query GetStops($stopIds: [String], $numberOfDepartures: Int!) {\n    stops(ids: $stopIds) {\n      name\n      gtfsId\n      stoptimesWithoutPatterns(numberOfDepartures: $numberOfDepartures) {\n        stop {\n          id\n          gtfsId\n          platformCode\n          __typename\n        }\n        scheduledArrival\n        realtimeArrival\n        arrivalDelay\n        scheduledDeparture\n        realtimeDeparture\n        departureDelay\n        usedTime: realtimeDeparture\n        timepoint\n        realtime\n        realtimeState\n        pickupType\n        dropoffType\n        serviceDay\n        headsign\n        trip {\n          route {\n            shortName\n            __typename\n          }\n          __typename\n        }\n        __typename\n      }\n      __typename\n    }\n  }\n`;\n\nexport const BusStop = () => {\n  const [time, setTime] = useState(\"\");\n  const [icon, setIcon] = useState(\"\");\n  const [temperature, setTemperature] = useState(\"\");\n\n  function getWeather() {\n    weather.getByCityName(\"Tampere\").then((x) => {\n      const temp = x.main.temp.toFixed(1);\n      setTemperature(temp);\n      setIcon((weatherIcons as any)[x.weather[0].icon]);\n    });\n  }\n\n  useEffect(() => {\n    getWeather();\n    const interval = setInterval(getWeather, 1000 * 60 * 10);\n    return () => clearInterval(interval);\n  }, []);\n\n  const handleTime = () => {\n    const date = new Date();\n    const localTime = date.toLocaleTimeString(\"en-US\", { hour12: false });\n\n    setTime(localTime);\n  };\n\n  useEffect(() => {\n    const timeout = setInterval(handleTime, 500);\n    return () => clearInterval(timeout);\n  }, []);\n\n  const { data } = useQuery(BUS_SCHEDULES, {\n    variables: {\n      stopIds: Object.keys(STOPS),\n      numberOfDepartures: 10,\n    },\n    pollInterval: 60 * 1000,\n  });\n\n  const stoptimes = data?.stops\n    ?.flatMap((stop: any) => stop.stoptimesWithoutPatterns)\n    .sort(\n      (a: any, b: any) =>\n        new Date(a.realtimeDeparture + a.serviceDay * 1000).getTime() -\n        new Date(b.realtimeDeparture + b.serviceDay * 1000).getTime()\n    );\n\n  return (\n    <>\n      <header className=\"header\">\n        <div className=\"weather\">\n          <div className=\"icon\">{icon}</div>\n          <div\n            className={`temperature ${\n              Number(temperature) > 0 ? \"positive\" : \"negative\"\n            }`}\n          >\n            {temperature}°C\n          </div>\n        </div>\n        <div className=\"time\">{time}</div>\n      </header>\n      <table className=\"bus\">\n        <thead>\n          <tr>\n            <th>Linja</th>\n            <th>Lähtöaika</th>\n          </tr>\n        </thead>\n        <tbody>\n          {stoptimes?.map((stoptime: any, i: number) => (\n            <tr\n              key={i}\n              style={{\n                background:\n                  STOPS[stoptime.stop.gtfsId as keyof typeof STOPS]?.background,\n              }}\n            >\n              <td>{stoptime.trip.route.shortName}</td>\n              <td>{formatTime(parseDaySeconds(stoptime.realtimeDeparture))}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </>\n  );\n};\n","import { useDoubleTap } from \"use-double-tap\";\n\nexport const LiveCamera: React.FC<{ goBack: () => void }> = ({ goBack }) => {\n  const bind = useDoubleTap(() => {\n    goBack();\n  });\n  return (\n    <>\n      <div\n        style={{\n          height: \"20vh\",\n          width: \"20vw\",\n          position: \"absolute\",\n          left: 0,\n          top: 0,\n          right: 0,\n          bottom: 0,\n          zIndex: 100,\n        }}\n        {...bind}\n      ></div>\n\n      <iframe\n        title=\"Live-camera\"\n        src=\"https://flycam.roundshot.co/kansijaareena/\"\n        style={{ height: \"100vh\", width: \"100vw\", borderWidth: \"0\" }}\n      ></iframe>\n    </>\n  );\n};\n","import { useState } from \"react\";\nimport { useDoubleTap } from \"use-double-tap\";\nimport { BusStop } from \"./components/BusStop\";\nimport { LiveCamera } from \"./components/LiveCamera\";\n\nconst App = () => {\n  const [selectedPage, setSelectedPage] = useState<\"bus-stop\" | \"live-camera\">(\n    \"bus-stop\"\n  );\n\n  const bind = useDoubleTap(() => {\n    setSelectedPage(selectedPage === \"bus-stop\" ? \"live-camera\" : \"bus-stop\");\n  });\n\n  const goBusStop = () => {\n    setSelectedPage(\"bus-stop\");\n  };\n\n  return (\n    <div className=\"App\" {...bind}>\n      {selectedPage === \"bus-stop\" && <BusStop />}\n      {selectedPage === \"live-camera\" && <LiveCamera goBack={goBusStop} />}\n    </div>\n  );\n};\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\nimport { ApolloClient, ApolloProvider, InMemoryCache } from \"@apollo/client\";\n\nconst client = new ApolloClient({\n  uri: \"https://api.digitransit.fi/routing/v1/routers/waltti/index/graphql\",\n  cache: new InMemoryCache(),\n});\n\nReactDOM.render(\n  <React.StrictMode>\n    <ApolloProvider client={client}>\n      <App />\n    </ApolloProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}